---
title: 'PEC1: Estadística descriptiva '
author: "marcusRB"
date: "October, 2025"
output: pdf_document
header-includes:
- \usepackage{xcolor}
- \usepackage{framed}
- \usepackage{listings}

---

# Sección 1. Importación, exportación y gestión de datos (2 puntos)

## (1 punto) Ejercicio 1
Se pide de descargar el dataset desde Kaggle disponible a la ruta indicada:

```{r}
# Descargar el dataset
# https://www.kaggle.com/datasets/amitvkulkarni/hair-health
```

Para ello utilizaremos el paquete `RKaggle` para descargar el dataset directamente desde R Studio

```{r include=FALSE}
if (!require('RKaggle')) install.packages('RKaggle')
library('RKaggle')
```

Preparamos el entorno cargando el resto de librerías que serán útiles para realizar
un análisis exploratorio de los datos.

```{r include=FALSE}
# Observamos las librerías disponibles y descargaremos el resto
library()
if(!require('corrplot')) install.packages('corrplot'); library('corrplot')
if(!require('tidyverse')) install.packages('tidyverse'); library('tidyverse')
if(!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
if(!require('Rmisc')) install.packages('Rmisc'); library('Rmisc')
if(!require('dplyr')) install.packages('dplyr'); library('dplyr')
if(!require('xfun')) install.packages('xfun'); library('xfun')
if(!require('psych')) install.packages('psych'); library('psych')
if(!require('visdat')) install.packages('visdat'); library('visdat')
```


***

### 1.1

Guardamos el dataset en un formato dataframe y comprobaremos

```{r}
# Guardamos el dataset en formato dataframe
HairFallH <- get_dataset('amitvkulkarni/hair-health')
```


```{r}
# Comprobamos si es un dataframe
is.data.frame(HairFallH)
```

Finalmente mostramos los primeros datos y la naturaleza de las características.

```{r}
# Mostramos los primeros datos con head()
head(HairFallH, 10)
```



```{r}
# Mostramos los últimos datos también con tail()
tail(HairFallH, 10)
```

***

### 1.2

Realizaremos un exploratorio genérico del dataset. Mostrando información básica del dataset, para pasar luego a los estadísticos básico y comenzaremos a interactuar con las características luego.

Verificamos la estructura del juego de datos principal. Vemos el número de columnas que tenemos y ejemplos de los contenidos de las filas.

```{r}
str(HairFallH)
```

```{r}
# Observamos su composición
dim(HairFallH)
```

Vemos que tenemos **13** características o variables y **999** registros.
De las características observamos que solamente existen 3 variables numéricas del
tipo double, y el resto, 10 variables del tipo objeto o character.

A simple vista las que podrían ser variables categoróricas, en realidad son 
características binarias (TRUE o FALSE), como podríamos interpolar por 1,0 si 
deseamos.

Podemos revisar la descripción de las variables contenidas en el fichero y si
los tipos de variables se corresponden con las que hemos cargado. Las
organizamos lógicamente para darles sentido y construimos un pequeño
diccionario de datos utilizando la documentación auxiliar.

```{r}
# Extraemos los nombres de las variables
names(HairFallH)
```


- **Genetics** : Indicates whether the individual has a family history of baldness (Yes/No).
- **Hormonal Changes**: Indicates whether the individual has experienced hormonal changes (Yes/No).
- **Medical Conditions**: Lists specific medical conditions that may contribute to baldness, such as Alopecia Areata, Thyroid Problems, Scalp Infection, Psoriasis, Dermatitis, etc.
- **Medications & Treatments**: Lists medications and treatments that may lead to hair loss, such as Chemotherapy, Heart Medication, Antidepressants, Steroids, etc.
- **Nutritional Deficiencies**: Lists nutritional deficiencies that may contribute to hair loss, such as Iron deficiency, Vitamin D deficiency, Biotin deficiency, Omega-3 fatty acid deficiency, etc.
- **Stress**: Indicates the stress level of the individual (Low/Moderate/High).
- **Age**: Represents the age of the individual.
- **Poor Hair Care Habits**: Indicates whether the individual practices poor hair care habits (Yes/No).
- **Environmental Factors**: Indicates whether the individual is exposed to environmental factors that may contribute to hair loss (Yes/No).
- **Smoking**: Indicates whether the individual smokes (Yes/No).
- **Weight Loss**: Indicates whether the individual has experienced significant weight loss (Yes/No).
- **Baldness (Target)**: Binary variable indicating the presence (1) or absence (0) of baldness in the individual.

Esta última variable, la variable predictora siendo binaria [0,1], nos indica que está renombrada como `Hair Loss`. 


Realizamos además un pequeño resumen estadístico de cada una de las variables


```{r}
# Con esta función observamos la distribución de los datos a grande rasgos.
summary(HairFallH)
```
El siguiente paso será observar si necesitaremos tratar los datos con la tareas de limpieza o imputaciones de los valores,  por ejemplo,  nulos o vacíos

```{r echo=TRUE, message=FALSE, warning=FALSE}
print('NA')
colSums(is.na(HairFallH))
print('Blancos')
print('Empty')
print('NAN')
colSums(HairFallH=="")
```

```{r}
# Verificamos más en detalle los valores na
sum(is.na(HairFallH))
colSums(is.na(HairFallH))
```
También de una manera más gráfica, podemos observar si existen valores nulos.

```{r}
# Visualizamos con el comando vis_miss del paquete visdat
vis_miss(HairFallH, )
```
Seguimos sin apreciar los datos nulos o vacíos. Por lo general nos tocará realizar 
un exploratorio más exhaustivo para observar la distribución de los datos, y, en
su caso ver si los datos de las variables categóricos, estén ocultos.

Vamos a crear histogramas y describir los valores para ver los datos en
general de estos atributos para hacer una primera aproximación a los
datos:

```{r echo=TRUE, message=FALSE, warning=FALSE}
summary(HairFallH[c("Hair Loss","Genetics")])

histList<- list()

n = c("Hair Loss", "Genetics")
HairFallAux = HairFallH %>% select(all_of(n))
histList <- list()

for(y in 1:ncol(HairFallAux)){
  col <- names(HairFallAux)[y]
  
  # Use backticks for column names with spaces
  ggp <- ggplot(HairFallAux, aes(x = .data[[col]])) +
    geom_histogram(bins = 30, fill = "cornflowerblue", color = "black") + 
    ggtitle(paste("Distribution of", col)) +  # More descriptive title
    xlab(col) +
    ylab("Count") +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
  
  histList[[y]] <- ggp
}

# Display all plots in a grid
if(length(histList) > 0) {
  do.call(grid.arrange, c(histList, ncol = 2))
}

```

***

## (1 punto) Ejercicio 2. Exploración del entorno RStudio y paquetes asociados.

Comprobamos que tenemos el paquete `datasets` descargado y obtenemos el conjunto BOD

```{r}
if (!require('datasets')) install.packages('datasets')
library('datasets')
```

Obtenemos el conjunto BOD y listamos el dataset

```{r}
bod <- datasets::BOD
```


```{r}
summary(bod)
```

```{r}
str(bod)
```

Observamos que tenemos solo *2 variable* del tipo númerico s y *6 registros*.


```{r}
# Veámos su composición
BOD
```

```{r}
# Buscamndo la información oficial
help(BOD)
```

Efectivamente desde el dataset `BOD` oficial, segúna la descripción de este 
dataset incluido con el paquete en R `datasets::BOD` nos indica:

> The BOD data frame has 6 rows and 2 columns giving the biochemical oxygen demand versus time in an evaluation of water quality.

Las dos variables nos dan información de:

> Time
A numeric vector giving the time of the measurement (days).
  demand
A numeric vector giving the biochemical oxygen demand (mg/l).

Seguramente es un dataset resultado de una prueba de concepto que está disponible
y referenciado:

**Source**
Bates, D.M. and Watts, D.G. (1988), *Nonlinear Regression Analysis and Its Applications*, Wiley, Appendix A1.4.

Originally from Marske (1967), *Biochemical Oxygen Demand Data Interpretation Using Sum of Squares Surface M.Sc. Thesis*, University of Wisconsin – Madison.

***

### 2.2

Ahora podemos guardar el dataframe resultante a un formato csv a nuestra carpeta
`working directory` de nuestro ordenador.

```{r}
# Podemos guardar este dataset directamente a nuestro entorno con el comando write_csv
write_csv(bod, "bod.csv")
```

Podemos comprobar como el fichero ha sido guardado correctamente

```{r}
WD <- getwd()
list.files(WD)
```


***

# Sección 2: Análisis básico del conjunto de datos (3,5 puntos)

## Ejercicio 3

Realizaremos un análisis exploratorio más detallado y comentaremos cada uno de los insights de las preguntas del enunciado.

### 3.1

*Calculad la proporción de personas según el nivel de estrés, agrupadas por el
tipo de deficiencia nutricional. Comentad los resultados.*

Utilizaremos ggplot para poder mostrar los datos en barras verticales por cada
una de las 3 categorías de la variable `Stress` indicando por colores rojos HIGH,
verde LOW, azule MODERATE

```{r}
# Mostramos los resultados de esta proporción
stress_prop <- HairFallH %>%
  group_by(`Nutritional Deficiencies`, Stress) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(`Nutritional Deficiencies`) %>%
  mutate(prop = count / sum(count))

ggplot(stress_prop, aes(x = `Nutritional Deficiencies`, y = prop, fill = Stress)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Proporción de niveles de estrés según deficiencia nutricional",
       x = "Deficiencia nutricional", y = "Proporción") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Podemos apreciar como los valores de `Selenium deficiency` se encuentra en una 
proporción del 40% más altarespecto a la `Vitamin D Deficiency`. Por lo que la correlación
entre estas dos variables pueda tener su importancia. Los valores de stress HIGH
mayor se encuentra con `Protein deficiency` y `Vitamin E deficiency` en un casi 35-38%.
El valor bajo LOW de stress está por `Biotin` y `Omega 3`. Sería oportuno realizar
unos cálculos más exhaustivos para poder correlacionar las dos variables y poder
extraer unas conclusiones más detalladas.


***

### 3.2
*Mostrad la relación entre el estrés y la caída de cabello . Mostrad un gráfico
que compare dichas proporciones*

Utilizamos siempre el paquete `ggplot2` para poder graficar y visualizar la relación
que hay entre estrés y la caída de cabello.

```{r}
stress_hairloss <- HairFallH %>%
  group_by(Stress, `Hair Loss` = `Hair Loss`) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(Stress) %>%
  mutate(prop = count / sum(count))

ggplot(stress_hairloss, aes(x = Stress, y = prop, fill = factor(`Hair Loss`))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Relación entre nivel de estrés y caída de cabello",
       x = "Nivel de estrés", y = "Proporción",
       fill = "Caída de cabello") +
  scale_fill_manual(values = c("#828282", "#8B3A3A"), labels = c("No", "Sí"))
```

Aunque los tres niveles de estrés puedan tener la misma proporción de pérdida
de cabello, un nivel moderado tiene una mayor proporción respecto al resto.
Asimismo la caída de cabello no influye por un nivel estrés alto ni bajo.

Al igual que ejercicio anterior, son conclusiones a simple vista de un gráfico.
Con unos cálculos estadístico de correlación, quizás podríamos ver más detalles
que con la gráfica podría ocultar.


***

### 3.3

*Evaluad la caída de cabello con deficiencias de nutrición específicas,
contando el número de personas por cada tipo de deficiencia nutricional.*


```{r}
ggplot(nutri_hairloss, aes(x = reorder(`Nutritional Deficiencies`, n), y = n, fill = n)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_fill_gradient(low = "#87CEEB", high = "#36648B") +
  labs(title = "Número de personas con caída de cabello por deficiencia nutricional",
       x = "Deficiencia nutricional", y = "Número de personas") +
  theme_minimal() +
  theme(legend.position = "none")
```

Este gráfico de barras horizontales nos muestra el número de personas que por 
deficiencia nutricional sí tienen caída de pelo, en valores absolutos.
Podemos apreciar que en orden tenemos la carencia de `Vitamina D`, `Zinc`, `Vitamin A`
`Protein`, `Magnesium`, `Biotin`, valores por encima de los 45. El resto se
encontrarían por debajo de este valor.


***

### 3.4

*Mostrad en una tabla el número de personas con caída de cabello, agrupadas
por nivel de estrés, que sean fumadoras y cuya edad sea inferior a la media de la
distribución*

Podemos realizar la tarea por parte. Primero analizamos la media de la distribución

```{r}
# Calcular media distribución
mean_age <- mean(HairFallH$Age, na.rm = TRUE)
mean_age
```

Entonces tenemos que realizar el filtro de aquellas personas solo con caída de cabello,
agrupamos por estrés YES, fumadoras YES y la edad es menor que 34.19

```{r}
tabla <- HairFallH %>%
  filter(`Hair Loss` == 1,
         Smoking == "Yes",
         Age < mean_age) %>%
  group_by(Stress) %>%
  summarise(count = n(), .groups = "drop")
```

```{r}
# La tabla mostraría este resultado.
tabla
```

Teniendo en cuenta la media de 34, aquellas personas que se encuentran por debajo
del promedio, con un nivel de estrés alto tenemos 37 personas; nivel bajo 38 y
un nivel moderado 56 personas.


***

### 3.5
*Mostrad las personas con edad mínima que presentan caída de cabello,
fuman, tienen el nivel de estrés alto y tienen algún tratamiento médico asociado. ¿Qué
deficiencia nutricional presentan?*

Primero calcularemos la edad mínima, y aplicaríamos los filtros.

```{r}
min_age <- min(HairFallH$Age[HairFallH$`Hair Loss` == 1], na.rm = TRUE)

tabla_filtrada <- HairFallH %>%
  filter(Age == min_age,
         `Hair Loss` == 1,
         Smoking == "Yes",
         Stress == "High",
         `Medications & Treatments` != "No Data") %>%
  select(Id, Age, `Nutritional Deficiencies`, `Medications & Treatments`)


tabla_filtrada
```

Mostramos la tabla con la edad mínima de 18 años, en particular 3 individuos con 
las respectivas deficiencias nutricional y que están siendo tratados.


***

### 3.6
*En base a las cuestiones realizadas anteriormente, añadid una nueva cuestión
que incluya una representación gráfica.*

Aplicamos una nueva cuestión de caída de cabello por condición médica y cambios
hormonales. Queremos ver si hay ciertas correlaciones según estos dos factores.

```{r}
combo_hairloss <- HairFallH %>%
  group_by(`Medical Conditions`, `Hormonal Changes`) %>%
  summarise(Mean_Hair_Loss = mean(`Hair Loss`), .groups = "drop")

ggplot(combo_hairloss, aes(x = `Hormonal Changes`, y = Mean_Hair_Loss, fill = `Hormonal Changes`)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~`Medical Conditions`) +
  scale_fill_manual(values = c("Yes" = "#8B475D", "No" = "grey70")) +
  labs(title = "Caída de cabello promedio por condición médica y cambios hormonales",
       x = "Cambios hormonales", y = "Proporción con caída de cabello",
       fill = "Cambios hormonales") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

A simple vista, un cambio hormonal NO afecta en los casos de "Alopecia Areata",
"Dermatitis", "Eczema", "Ringworm", "Scalp Infection". Sin embargo, sí vemos que
un cambio hormonal afecta a los síntomas de "Androgenetic Alopecia", "Dermatosis"
"Seborrheic Dermatisis" y "Psioriasis" más que al resto. Se podría estudiar más
el caso y cada síntoma para poder ver su causa-efecto para poder dar una respuesta
correcta a los gráficos actuales.



***

# Sección 3: Estadística descriptiva y gráficos (4,5 puntos)

*El objetivo de este apartado trabajar los conceptos de estadística descriptiva y
representación de gráficos. Para ello, seguiremos trabajando con el conjunto de datos de
la sección anterior.*

## (4,5 puntos) Ejercicio 4

### 4.1. (0,5 puntos) 

*A partir del conjunto de datos citado, mostrad los estadísticos descriptivos
más relevantes y comentad los resultados, teniendo en cuenta el tipo de variables del
conjunto de datos.*

```{r}
# Estadísticos descriptivos para variables numéricas
num_summary <- HairFallH %>%
  select(`Age`,`Genetics`, `Hormonal Changes`, `Medical Conditions`, 
         `Medications & Treatments`, `Nutritional Deficiencies`, 
         Stress, `Poor Hair Care Habits`, `Environmental Factors`, 
         Smoking, `Weight Loss`) %>%
  psych::describe()

num_summary
```

```{r}
# Frecuencias para variables categóricas
cat_summary <- HairFallH %>%
  select(`Genetics`, `Hormonal Changes`, `Medical Conditions`, 
         `Medications & Treatments`, `Nutritional Deficiencies`, 
         Stress, `Poor Hair Care Habits`, `Environmental Factors`, 
         Smoking, `Weight Loss`) %>%
  summarise(across(everything(), ~length(unique(.x))))

cat_summary
```



***

### 4.2. (1 punto) 

*Realizad un boxplot que relacione la edad con la caída de cabello, ¿qué podéis
concluir?*

Mostramos el gráfico de esta relación con un boxplot a través del paquete ggplot2.

```{r}
ggplot(HairFallH, aes(x = factor(`Hair Loss`, labels = c("No", "Sí")), 
                      y = Age, 
                      fill = factor(`Hair Loss`))) +
  geom_boxplot() +
  scale_fill_manual(values = c("0" = "grey70", "1" = "#8B475D")) +
  labs(title = "Relación entre la edad y la caída de cabello",
       x = "Caída de cabello", y = "Edad",
       fill = "Caída de cabello") +
  theme_minimal()
```
A simple vista, no parece ser un factor ni tener correlación que la edad pueda influir del todo en la pérdida del cabello. Se puede apreciar que la mediana, así como el mínimo y el máximo son valores con diferencia poco significativa. De hecho, necesitaríamos tener en cuenta otras características, como stress, factores ambientales, o hormonal y genética. Sin embargo, podemos ver también que el dataset incluye solo una muestra de 999 individuos de 18 a 50, equilibrando los casos positivos y negativo de pérdida de pelo en una muestra homogénea, quizás para estudiar otros factores y no tener el sesgo por edad.

```{r}
# Mostramos efectivamente la distribución de esta característica
summary(HairFallH$'Age')
```


***

### 4.3. (1 punto)

*Realizad una tabla de frecuencias que relacione las condiciones médicas de las
personas con el factor de caída del cabello y realizad gráfico tipo 'Mapa de calor' para
visualizar cuales son los factores más relevantes.*

```{r}
# Se crea la tabla de frecuencias
tabla_medical <- HairFallH %>%
  group_by(`Medical Conditions`, `Hair Loss`) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = `Hair Loss`, values_from = count, values_fill = 0)

# Ordenamos por mayor número de "Sí" (Hair Loss = 1) para tener una mejor visualización
tabla_medical <- tabla_medical %>%
  arrange(desc(`1`))

# Convertimos a formato largo para el heatmap
heat_data <- tabla_medical %>%
  melt(id.vars = "Medical Conditions", variable.name = "Hair_Loss", value.name = "count")

# Vamos a ordenar los factores para que aparezcan de mayor a menor
heat_data$`Medical Conditions` <- factor(heat_data$`Medical Conditions`,
                                         levels = tabla_medical$`Medical Conditions`)

# Creamos las etiquetas legibles para el eje x
heat_data$Hair_Loss <- factor(heat_data$Hair_Loss,
                              levels = c("1", "0"),
                              labels = c("Sí pérdida", "No pérdida"))

# Creamos el gráfico con ggplot
ggplot(heat_data, aes(x = Hair_Loss, y = `Medical Conditions`, fill = count)) +
  geom_tile(color = "white") +
  geom_text(aes(label = count), color = "white", size = 3.5) +
  scale_fill_gradient(low = "#74add1", high = "#d73027") +  # azul→rojo
  labs(title = "Mapa de calor: condiciones médicas y pérdida de cabello",
       x = "Caída de cabello", y = "Condición médica",
       fill = "Número de casos") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Quitando los valores de No Data, donde tenemos un conteo de 63 individuos, vemos
que la "Alopecia Areata" y "Androgenetic Alopecia" inciden bastante , seguido por 
"Seborrheic Dermatisis" y "Psioriasis" . Seguramente afectarán la pérdida de 
cabello más que otros síntomas. Mientras que la no caída de cabello no está afectada
por ejemplo con problemas de "Thyroid", más que el resto y un 50% con "Psioriasis".
***

### 4.4. (1 punto) 

*Representad un histograma de la edad de las personas con caída de cabello. A
partir de aquí, y teniendo en cuenta los conceptos de normalidad trabajados al LAB1,
representad la curva de densidad normal y evaluad la normalidad de la distribución y
comentad los resultados.*

Mostramos un gráfico donde mostraremos la distribución, tiene que mostrar una 
forma de campana más hacía el centro donde viene representada la mediana y la moda.
Finalmente vemos la densidad normal.


```{r warning=FALSE}
ggplot(HairFallH %>% filter(`Hair Loss` == 1), aes(x = Age)) +
  geom_histogram(aes(y = ..density..), bins = 20, fill = "#69b3a2", color = "white") +
  geom_density(color = "red", size = 1) +
  stat_function(fun = dnorm,
                args = list(mean = mean(HairFallH$Age, na.rm = TRUE),
                            sd = sd(HairFallH$Age, na.rm = TRUE)),
                color = "blue", linetype = "dashed") +
  labs(title = "Distribución de la edad en personas con caída de cabello",
       x = "Edad", y = "Densidad") +
  theme_minimal()

```

A primera vista tenemos la densidad más hacía el promedio, estamos entorno a 30 años y 
la mediana toca justo a los 34. Tenemos valores de frecuencia más altos en un primer
rango entre 20-25, un segundo entre 30-35, otro casi a los 40-45

Parece indicar que la muestra está bien repartida de forma homogénea para que
se puedan tomar en cuenta los valores y no tener sesgos.


***


### 4.5. (1 punto)

*A partir del ejercicio 5 del LAB1 que trabaja con los datos Airquality del
paquete datasets, realiza un análisis de correlación lineal sobre dos de las variables del
conjunto de datos y realiza la representación gráfica que más se ajuste.*


```{r}
data("airquality")

# Creamos y seleccionaremos las variables numéricas relevantes
cor_data <- airquality %>%
  select(Ozone, Temp, Wind, Solar.R) %>%
  drop_na()

# Creamos una matriz de correlación
cor_matrix <- cor(cor_data)
round(cor_matrix, 2)

# Mostramos gráficamente
corrplot(cor_matrix, method = "color", type = "upper",
         addCoef.col = "#828282", tl.col = "black",
         title = "Correlación entre variables del dataset Airquality",
         mar = c(0,0,2,0))

```
Observamos que en la diagonal tenemos los valores 1, entre sus propias características.
Pero las que nos importan son `Temp`y `Ozone` tienen una correlación fuerta positiva
de 0,70 mientras por el opuesto, `Wind` y `Ozone` tiene una correlación casi fuerte
negativa de -0,61. Esto significa que si crece el nivel de ozono la temperatura
se eleva, es directamente proporcional. Mientras que si hay viento, no es porque
hay más ozono o menos, es indirectamente proporcional. Por este motivo al crecer
unos valores de una característica, baja el otro y viceversa.


