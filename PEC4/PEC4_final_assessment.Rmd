---
title: 'PEC4: Final assessment'
author: "Marco Russo - Silvia Gamundi Sumando"
date: "Enero, 2025"
output:
  pdf_document: 
    toc: true
    toc_depth: 4
    number_sections: true
    fig_width: 7
    fig_height: 5
    fig_caption: true
    keep_tex: false
    latex_engine: xelatex
  html_document:
    toc: true
    toc_float: true
    df_print: paged
header-includes:
- \usepackage{xcolor}
- \usepackage{framed}
- \usepackage{listings}
- \usepackage{fancyhdr}
- \usepackage{geometry}
- \usepackage{caption}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{graphicx}
- \geometry{top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm}
- \pagestyle{fancy}
- \fancyfoot[C]{\thepage}
- \renewcommand{\headrulewidth}{0.4pt}
- \renewcommand{\footrulewidth}{0.4pt}
---

\newpage

# Información del Estudiante

\begin{center}
\begin{tabular}{|l|l|}
\hline
\textbf{Nombre} & Marco Russo \\
\hline
\textbf{Email} & mrussorb@uoc.edu \\
\hline
\textbf{GitHub} & https://github.com/marcusRB/uoc-ub-scientific-programming \\
\hline
\textbf{LinkedIn} & https://www.linkedin.com/in/marcusrb/ \\
\hline
\textbf{Fecha} & \today \\
\hline
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{|l|l|}
\hline
\textbf{Nombre} & Silvia Gamundi Sumando \\
\hline
\textbf{Email} & sgamundis@uoc.edu
 \\
\hline
\textbf{GitHub} & https://github.com/ \\
\hline
\textbf{LinkedIn} & https://www.linkedin.com/in/ \\
\hline
\textbf{Fecha} & \today \\
\hline
\end{tabular}
\end{center}


\newpage



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      fig.width = 10, fig.height = 6)
```


# Sección 1. Contexto y objetivo del estudio. Datos (1 punto)

El dataset elegido es `Bacteremia` Heinze, G. (2023). Bacteremia [Data set]. In PLoS One (Version S2, Vol. 9, Number 9, p. e106765). Zenodo. https://doi.org/10.5281/zenodo.7554815

El resto de informaciones extracto del sitio oficial:

> The data set consists of 14,691 observations from different patients with the clinical suspicion to suffer from bacteremia, for whom a a blood culture analysis was performed at the Vienna General Hospital, Austria, between January 2006 and December 2010. It contains the results of the blood culture analysis for bacteremia and the values of 51 potential predictors of bacteremia. To protect data privacy our version of this data was slightly modified compared to the original version, and this modified version was cleared by the Medical University of Vienna for public use (DC 2019-0054).  Details on the meaning of the variables can be found in the data dictionary. The original version of the data set was used by Ratzinger et al (2014) to develop a model for screening bacteremic patients based on highly standardizable laboratory variables. This public version has been used by Gregorich et al (2021).

Basada en la descripción oficial del mismo, se indican que existen 14,691 observaciones de diferentes pacientes que podrían ser afectos de `bacteriemia`. De la información disponible en [Wikipedia:Bacteriemia](https://es.wikipedia.org/wiki/Bacteriemia), la bacteriemia es la presencia de bacterias en la sangre. La sangre es normalmente un medio estéril, por lo tanto la detección de bacterias es indicativa de infección. 

Es importante entender este punto respecto al **diagnóstico**, muchas personas se recuperan completamente de la bacteriemia. Sin embargo, la bacteriemia es grave y puede provocar sepsis. Cuando tiene sepsis, el daño a los órganos principales puede ser irreversible. 

Entre las **causas**, la entrada de bacterias en el torrente sanguíneo puede ser producto de una infección localizada (ej: neumonía, absceso en piel o mucosas), o por interrupción de la piel como barrera defensiva. Se destacan las intervenciones quirúrgicas, utilización de dispositivos invasivos (catéteres, sondas, asistencia mecánica respiratoria), heridas accidentales, o quemaduras.

La infección suele empezar en los pulmones, el tracto genitourinario, gastrointestinal o los tejidos blandos, entre ellos la piel de pacientes con úlceras. También puede ser secundaria a una intervención dental en pacientes de alto riesgo, especialmente en los que tienen prótesis intravasculares. 

Respecto a las **consecuencias**, dependen del tipo de bacteria y el estado del paciente. La respuesta inmunológica a la infección puede causar sepsis y devenir en shock séptico. También puede ocurrir que la sangre transporte las bacterias a otros tejidos, que podrán ser infectados. Ejemplos incluyen endocarditis, osteomielitis, y meningitis. El tratamiento es fundamental para erradicar a las bacterias y requiere el uso de antibióticos por vía intravenosa. 

Tenemos un pequeño diccionario disponible del significado de cada característica del dataset, lo descargaremos y visualizaremos para entender mejor el contexto.



***

# Sección 2. Prospección y preparación de los datos (2 puntos)

## 2.1 Descripción de los datos (1 punto)


Preparamos el entorno cargando el resto de librerías que serán útiles para realizar
un análisis exploratorio de los datos.

```{r include=FALSE}
# Observamos las librerías disponibles y descargaremos el resto
library()
if(!require('corrplot')) install.packages('corrplot'); library('corrplot')
if(!require('tidyverse')) install.packages('tidyverse'); library('tidyverse')
if(!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
if(!require('Rmisc')) install.packages('Rmisc'); library('Rmisc')
if(!require('dplyr')) install.packages('dplyr'); library('dplyr')
if(!require('xfun')) install.packages('xfun'); library('xfun')
if(!require('psych')) install.packages('psych'); library('psych')
if(!require('visdat')) install.packages('visdat'); library('visdat')
```

Descargamos el dataset en un formato dataframe y comprobaremos

```{r}
# Create directory if it doesn't exist
if (!dir.exists("data")) {
  dir.create("data", recursive = TRUE)
}

# Define the URL and file path
url <- "https://zenodo.org/records/7554815/files/Bacteremia_public_S2.csv?download=1"
filename <- "data/bacteremia_dataset.csv"

# Download the file
download.file(url, destfile = filename, mode = "wb")  # "wb" for binary mode on Windows

# Read the CSV file
bacteremia_df <- read.csv(file = filename)

# Preview the data
dplyr::glimpse(bacteremia_df)
```


```{r}
# Comprobamos si es un dataframe
is.data.frame(bacteremia_df)
```

Finalmente mostramos los primeros datos y la naturaleza de las características.

```{r}
# Mostramos los primeros datos con head()
head(bacteremia_df, 10)
```



```{r}
# Mostramos los últimos datos también con tail()
tail(bacteremia_df, 10)
```

Realizaremos un exploratorio genérico del dataset. Mostrando información básica del dataset, para pasar luego a los estadísticos básico y comenzaremos a interactuar con las características luego.

Verificamos la estructura del juego de datos principal. Vemos el número de columnas que tenemos y ejemplos de los contenidos de las filas.

```{r}
str(bacteremia_df)
```

```{r}
# Observamos su composición
dim(bacteremia_df)
```

Vemos que tenemos **53** características o variables y **14691** registros.


```{r}
# Obtenemos el datatype de cada característica
sapply(bacteremia_df, class)
```

De las características observamos que existen 3 variables del tipo "integer",
del
tipo double, y el resto, 10 variables del tipo objeto o character.

A simple vista las que podrían ser variables categoróricas, en realidad son 
características binarias (TRUE o FALSE), como podríamos interpolar por 1,0 si 
deseamos.

Podemos revisar la descripción de las variables contenidas en el fichero y si
los tipos de variables se corresponden con las que hemos cargado. Las
organizamos lógicamente para darles sentido y construimos un pequeño
diccionario de datos utilizando la documentación auxiliar.


Respecto al significado de cada una de las features utilizaremos el fichero 
DataDictionary - https://zenodo.org/records/7554815/files/bacteremia-DataDictionary.csv
disponible en la misma página oficial para interpretar los valores.

```{r}
# Read directly from URL
dictionary_df <- read.csv("https://zenodo.org/records/7554815/files/bacteremia-DataDictionary.csv?download=1")

# Display as a nice formatted table
library(DT)
datatable(dictionary_df, 
          options = list(pageLength = 20, 
                         scrollX = TRUE,
                         searchHighlight = TRUE),
          rownames = FALSE)
```




***

## 2.2 Preguntas “objetivo” (1 punto)
ver LAB3 y PEC1

***

# Sección 3. Análisis exploratorio de los datos (2,5 puntos)

## 3.1 Análisis descriptivo y gráfico (1 punto)
ver LAB2

***

## 3.2. Ejercicios de inferencia y simulación (1,5 puntos)
ver LAB3, LAB4, PEC2

***

# Sección 4. Modelos de aprendizaje automático (2,5 puntos)
 
ver LAB5 y PEC3



***

# Sección 5. Visualización (1,5 puntos)

ver LAB6 y PEC3

***
# Sección 6. Conclusiones (0,5 puntos)



***

# Bibliografía


References

1. Wolberg,W.H., and Mangasarian,O.L. (1990). Multisurface method of pattern separation for medical diagnosis applied to breast cytology. In Proceedings of the National Academy of Sciences, 87, 9193-9196.
- Size of data set: only 369 instances (at that point in time)
- Collected classification results: 1 trial only
- Two pairs of parallel hyperplanes were found to be consistent with 50% of the data
- Accuracy on remaining 50% of dataset: 93.5%
- Three pairs of parallel hyperplanes were found to be consistent with 67% of data
- Accuracy on remaining 33% of dataset: 95.9%

2. Zhang,J. (1992). Selecting typical instances in instance-based learning. In Proceedings of the Ninth International Machine Learning Conference (pp. 470-479). Aberdeen, Scotland: Morgan Kaufmann.
- Size of data set: only 369 instances (at that point in time)
- Applied 4 instance-based learning algorithms
- Collected classification results averaged over 10 trials
- Best accuracy result:
- 1-nearest neighbor: 93.7%
- trained on 200 instances, tested on the other 169
- Also of interest:
- Using only typical instances: 92.2% (storing only 23.1 instances)
- trained on 200 instances, tested on the other 169

Blake, C.L. & Merz, C.J. (1998). UCI Repository of Machine Learning Databases. Irvine, CA: University of California, Irvine, Department of Information and Computer Science. Formerly available from http://www.ics.uci.edu/~mlearn/MLRepository.html.


* https://shiny.posit.co/py/templates/


***








