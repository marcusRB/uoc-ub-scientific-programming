---
title: 'PEC4: Final assessment'
author: "Marco Russo - Silvia Gamundi Sumando"
date: "Enero, 2025"
output:
  pdf_document: 
    toc: true
    toc_depth: 4
    number_sections: true
    fig_width: 7
    fig_height: 5
    fig_caption: true
    latex_engine: xelatex
    highlight: tango
    citation_package: natbib
header-includes:
- \usepackage{xcolor}
- \usepackage{framed}
- \usepackage{listings}
- \usepackage{fancyhdr}
- \usepackage{geometry}
- \usepackage{caption}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{graphicx}
- \geometry{top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm}
- \pagestyle{fancy}
- \fancyfoot[C]{\thepage}
- \renewcommand{\headrulewidth}{0.4pt}
- \renewcommand{\footrulewidth}{0.4pt}
editor_options: 
  markdown: 
    wrap: 72
bibliografy: 7554815.bib
---

\newpage

Información del Estudiante

\begin{center}
\begin{tabular}{|l|l|}
\hline
\textbf{Nombre} & Marco Russo \\
\hline
\textbf{Email} & mrussorb@uoc.edu \\
\hline
\textbf{GitHub} & https://github.com/marcusRB/uoc-ub-scientific-programming \\
\hline
\textbf{LinkedIn} & https://www.linkedin.com/in/marcusrb/ \\
\hline
\textbf{Fecha} & \today \\
\hline
\end{tabular}
\end{center}
\begin{center}
\begin{tabular}{|l|l|}
\hline
\textbf{Nombre} & Silvia Gamundi Sumando \\
\hline
\textbf{Email} & sgamundis@uoc.edu
 \\
\hline
\textbf{GitHub} & https://github.com/ \\
\hline
\textbf{LinkedIn} & https://www.linkedin.com/in/ \\
\hline
\textbf{Fecha} & \today \\
\hline
\end{tabular}
\end{center}

\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,           # Mostrar código
  warning = FALSE,       # No mostrar warnings
  message = FALSE,       # No mostrar mensajes
  fig.align = 'center',  # Centrar figuras
  fig.width = 8,         # Ancho de figuras
  fig.height = 5,        # Alto de figuras
  out.width = '80%',     # Tamaño de salida
  cache = FALSE,         # No cachear resultados
  tidy = TRUE,           # Formatear código
  tidy.opts = list(width.cutoff = 60)
)
```

# 1. Contexto y objetivo del estudio. Datos (1 punto)

El dataset elegido es `Bacteremia` del autor Heinze, G. (2023).
Bacteremia [Data set]. In PLoS One (Version S2, Vol. 9, Number 9, p.
e106765). Zenodo. <https://doi.org/10.5281/zenodo.7554815> [^1]

El resto de informaciones ha sido extracto de la fuenta oficial:

> The data set consists of 14,691 observations from different patients
> with the clinical suspicion to suffer from bacteremia, for whom a a
> blood culture analysis was performed at the Vienna General Hospital,
> Austria, between January 2006 and December 2010.

> It contains the results of the blood culture analysis for bacteremia and the values of
> 51 potential predictors of bacteremia. To protect data privacy our
> version of this data was slightly modified compared to the original
> version, and this modified version was cleared by the Medical
> University of Vienna for public use (DC 2019-0054).

>The original version of the data set was used by Ratzinger et al (2014) to
> develop a model for screening bacteremic patients based on highly
> standardizable laboratory variables. This public version has been used
> by Gregorich et al (2021).

Basada en la descripción oficial del mismo, se indican que existen
14,691 observaciones de diferentes pacientes que podrían ser afectos de
`bacteriemia`. De la información disponible en Wikipedia:Bacteriemia [^2], la
bacteriemia es la presencia de bacterias en la sangre. La sangre es
normalmente un medio estéril, por lo tanto la detección de bacterias es
indicativa de infección.

Es importante entender este punto respecto al **diagnóstico**, muchas
personas se recuperan completamente de la bacteriemia. Sin embargo, la
bacteriemia es grave y puede provocar sepsis. Cuando tiene sepsis, el
daño a los órganos principales puede ser irreversible.

Entre las **causas**, la entrada de bacterias en el torrente sanguíneo
puede ser producto de una infección localizada (ej: neumonía, absceso en
piel o mucosas), o por interrupción de la piel como barrera defensiva.
Se destacan las intervenciones quirúrgicas, utilización de dispositivos
invasivos (catéteres, sondas, asistencia mecánica respiratoria), heridas
accidentales, o quemaduras.

La infección suele empezar en los pulmones, el tracto genitourinario,
gastrointestinal o los tejidos blandos, entre ellos la piel de pacientes
con úlceras. También puede ser secundaria a una intervención dental en
pacientes de alto riesgo, especialmente en los que tienen prótesis
intravasculares.

Respecto a las **consecuencias**, dependen del tipo de bacteria y el
estado del paciente. La respuesta inmunológica a la infección puede
causar sepsis y devenir en shock séptico. También puede ocurrir que la
sangre transporte las bacterias a otros tejidos, que podrán ser
infectados. Ejemplos incluyen endocarditis, osteomielitis, y meningitis.
El tratamiento es fundamental para erradicar a las bacterias y requiere
el uso de antibióticos por vía intravenosa.

Se dispone de un pequeño diccionario que incluye el significado de cada
característica del dataset. Lo descargaremos y visualizaremos para
entender mejor el contexto de cada característica del dataset.

------------------------------------------------------------------------

# 2. Prospección y preparación de los datos (2 puntos)

## 2.1 Descripción de los datos (1 punto)

Preparamos el entorno cargando el resto de librerías que serán útiles
para realizar un análisis exploratorio de los datos.

```{r include=FALSE}
# Observamos las librerías disponibles y descargaremos el resto
if(!require('corrplot')) install.packages('corrplot'); library('corrplot')
if(!require('tidyverse')) install.packages('tidyverse'); library('tidyverse')
if(!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
if(!require('dplyr')) install.packages('dplyr'); library('dplyr')
if(!require('naniar')) install.packages('naniar'); library('naniar')
if(!require('summarytools')) install.packages('summarytools'); library('summarytools')
if(!require('skimr')) install.packages('skimr'); library('skimr')
if(!require('DataExplorer')) install.packages('DataExplorer'); library('DataExplorer')

```

Descargamos el dataset en un formato dataframe y comprobaremos su
estructura.

```{r}
# Define the URL and file path
url <- "https://zenodo.org/records/7554815/files/Bacteremia_public_S2.csv?download=1"
filename <- "data/bacteremia_dataset.csv"

# Create directory if it doesn't exist
if (!dir.exists("data")) {
  dir.create("data", recursive = TRUE)
  
  # Download the file
  download.file(url, destfile = filename, mode = "wb")
} else {
  sprintf("The dataset has been downloaded and is available in 'data' path")
}

```

```{r}
# Read the CSV file
bacteremia_df <- read.csv(file = filename)

# Preview the data
dplyr::glimpse(bacteremia_df)
```

Finalmente mostramos los primeros datos y la naturaleza de las
características.

```{r}
# Mostramos los primeros datos con head()
head(bacteremia_df, 10)
```

```{r}
# Mostramos los últimos datos también con tail()
tail(bacteremia_df, 10)
```

Realizaremos un exploratorio genérico del dataset. Mostrando información
básica del dataset, para pasar luego a los estadísticos básico y
comenzaremos a interactuar con las características luego.

Verificamos la estructura del juego de datos principal. Vemos el número
de columnas que tenemos y ejemplos de los contenidos de las filas.

```{r}
str(bacteremia_df)
```

```{r}
# Observamos su composición
dim(bacteremia_df)
```

Vemos que tenemos **53** características y **14691** observaciones.
Deberíamos profundizar ahora respecto al tipo de dato de cada variable y
realizar un exploratorio básico para ver inconsistencias.

```{r}
# Obtenemos el datatype de cada característica
sapply(bacteremia_df, class)
```

Respecto a las características, no tenemos transformaciones previas a
realizar, exceptuando nuevas features que podríamos crear sucesivamente.

Procederemos con un exploratorio básico extrayendo la información
estadístico de las características del dataset.

```{r}
# Mostramos los estadísticos en pantalla, los valores nulos y frecuentes
dfSummary(bacteremia_df)
```

De las 53 características observamos que existen:

-   2 variables del tipo numérica discretas (SEX, BloodCulture), aunque
    podríamos tratar esta última como variable dependiente.
-   50 variables son del tipo numérica continua a excepción de la
    característica id del paciente `ID`, que no es considerada para la
    modelización, peró en caso de realizar segmentación, podría ser
    útil.

Hay que tener en cuenta que la variable `AGE` ha sido modificada de origen
ligermente por lo que los estudios analíticos a continuación, no serán
del todo precisas y fiables. Por lo que propondríamos suposiciones a lo
largo del estudio.

Podemos revisar la descripción de las variables contenidas en el fichero
y si los tipos de variables se corresponden con las que hemos cargado.
Las organizamos lógicamente para darles sentido y construimos un pequeño
diccionario de datos utilizando la documentación auxiliar.

Respecto al significado de cada una de las features utilizaremos el
fichero DataDictionary -
<https://zenodo.org/records/7554815/files/bacteremia-DataDictionary.csv>
disponible en la misma página oficial para interpretar los valores.

```{r }
# Read directly from URL
dictionary_df <- read.csv("https://zenodo.org/records/7554815/files/bacteremia-DataDictionary.csv?download=1")

# Display as a nice formatted table
library(DT)
datatable(dictionary_df,
          options = list(pageLength = 20,
                         scrollX = TRUE,
                         searchHighlight = TRUE),
          rownames = FALSE)
```

A continuación comprobaremos los valores nulos que podrían estar en
nuestro dataset.

```{r}
# Verificación de valores perdidos
na_count <- sapply(bacteremia_df, function(x) sum(is.na(x)))
print(na_count[na_count > 0])
```

De las 14691 observaciones, disponemos de muchos valores nulos, podemos
realizar un análisis para comprobar el porcentaje que podría este
afectar a la estabilidad de los análisis.

```{r}

# Visualize missing values by variable
gg_miss_var(bacteremia_df, show_pct = TRUE) +
  labs(title = "variables faltantes en Bacteremia",
       x = "Variables",
       y = "Ratio de los valores nulos")
```

Calcularemos los valores totales y su ratio.

```{r}
missing_summary <- data.frame(
  Variable = names(bacteremia_df),
  Missing_Count = colSums(is.na(bacteremia_df)),
  Missing_Percent = round(colSums(is.na(bacteremia_df))/nrow(bacteremia_df)*100, 2)
) %>%
  arrange(desc(Missing_Percent))

print("Missing Data Summary:")
print(missing_summary)
```

Notamos que no existe características que superen al umbral del 70% de
los valores nulos, lo que podríamos considerar a eliminar la
característica de nuestros análisis.

Sin embargo, hay valores que necesitaríamos analizar a posteriori por
tener unos valores faltantes entre el 10% y 40% que supone tener que
tomar decisiones.

```{r}
filter(missing_summary, missing_summary$Missing_Percent > 20)
```

```{r}
filter(missing_summary, missing_summary$Missing_Percent > 0 & missing_summary$Missing_Percent < 20)
```

Tenemos 7 características superior al 20% de valores nulos y 42 de muy
residual, debajo del 1% hasta el 20%. Podemos realizar un análisis
exhaustivo para poder tomar decisiones al respecto, cuáles tareas de
imputaciones de los valores faltantes por segmentación de valores
cercanos (por ejemplo algún valor estadístico tipo media, mediana) o a
través de técnicas de aprendizaje automático (utilizar segmentación a
través de k-Means u otros métodos supervisado tipo kNN).

------------------------------------------------------------------------

## 2.2 Preguntas “objetivo” (1 punto)

Antes de comenzar con las preguntas objetivos, obtenemos una
clasificación de los valores indicadores como rango de referencia para el hemocultivo. 

De esta manera agruparemos los valores de las features por categoría:

### **A. Marcadores de inflamación e infección** (Alta correlación esperada)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| CRP | C-reactive protein | < 5 mg/L |
| HS | Hypersensitive CRP | < 1 mg/L |
| NT | Neutrophils | 40–75 % |
| WBC | White blood cells | 4–10 ×10⁹/L |
| LDH | Cell damage / inflammation | 140–280 U/L |
| **PCT** | **Procalcitonin** | **< 0.5 ng/mL** |

### **B. Coagulación y hemostasia** (Correlación indirecta/moderada)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| FIB | Fibrinogen | 200–400 mg/dL |
| APTT | Coagulation time | 25–35 s |
| PLT | Platelets | 150–400 ×10⁹/L |
| **PT** | **Prothrombin time** | **11–13.5 s** |
| **INR** | **International normalized ratio** | **0.8–1.2** |
| **DD** | **D-dimer** | **< 500 ng/mL** |

### **C. Perfil metabólico y lipídico** (Correlación indirecta/débil)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| GLU | Glucose | 70–100 mg/dL |
| TRIG | Triglycerides | < 150 mg/dL |
| CHOL | Cholesterol | < 200 mg/dL |
| **HDL** | **HDL cholesterol** | **> 40 mg/dL** |
| **LDL** | **LDL cholesterol** | **< 100 mg/dL** |

### **D. Función hepática y proteínas** (Correlación indirecta/moderada)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| ALB | Albumin | 3.5–5.0 g/dL |
| TP | Total proteins | 6.0–8.3 g/dL |
| CHE | Cholinesterase | 5,000–12,000 U/L |
| **TBIL** | **Total bilirubin** | **0.1–1.2 mg/dL** |
| **DBIL** | **Direct bilirubin** | **0–0.3 mg/dL** |
| **AST** | **Aspartate aminotransferase** | **10–40 U/L** |
| **ALT** | **Alanine aminotransferase** | **7–56 U/L** |
| **GGT** | **Gamma-glutamyl transferase** | **8–61 U/L** |
| **ALP** | **Alkaline phosphatase** | **30–120 U/L** |

### **E. Daño tisular/muscular** (Correlación variable)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| CK | Creatine kinase | 30–200 U/L |
| LDH | Cell damage | 140–280 U/L |
| **CKMB** | **CK-MB (cardiac marker)** | **< 25 U/L** |

### **F. Enzimas pancreáticas** (Correlación débil - contextual)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| AMY | Amylase | 30–110 U/L |
| PAMY | Pancreatic amylase | 13–53 U/L |
| LIP | Lipase | < 160 U/L |

### **G. Electrolitos y minerales** (Correlación indirecta/moderada)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| POTASS | Potassium | 3.5–5.1 mmol/L |
| MG | Magnesium | 1.7–2.2 mg/dL |
| **NA** | **Sodium** | **136–145 mmol/L** |
| **CL** | **Chloride** | **98–107 mmol/L** |
| **CA** | **Calcium** | **8.5–10.5 mg/dL** |
| **PHOS** | **Phosphate** | **2.5–4.5 mg/dL** |

### **H. Función renal** ⭐ (Alta correlación esperada)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| **CREA** | **Creatinine** | **0.7–1.3 mg/dL** |
| **BUN** | **Blood urea nitrogen** | **7–20 mg/dL** |
| **UA** | **Uric acid** | **3.5–7.2 mg/dL** |

### **I. Hematología completa** (Correlación variable)
| Variable | Meaning | Typical Range |
|----------|---------|---------------|
| WBC | White blood cells | 4–10 ×10⁹/L |
| **RBC** | **Red blood cells** | **4.5–5.5 ×10¹²/L** |
| **HGB** | **Hemoglobin** | **13–17 g/dL** |
| **HCT** | **Hematocrit** | **40–50 %** |
| **MCV** | **Mean corpuscular volume** | **80–100 fL** |
| **MCH** | **Mean corpuscular hemoglobin** | **27–33 pg** |
| **MCHC** | **Mean corpuscular Hb concentration** | **32–36 g/dL** |
| **PLT** | Platelets | 150–400 ×10⁹/L |
| **NT** | Neutrophils | 40–75 % |
| **LY** | **Lymphocytes** | **20–40 %** |
| **MONO** | **Monocytes** | **2–8 %** |
| **EO** | **Eosinophils** | **1–4 %** |
| **BASO** | **Basophils** | **0.5–1 %** |

### **J. Variables demográficas y clínicas**
| Variable | Meaning | Notes |
|----------|---------|-------|
| **Age** | Patient age | Correlación moderada |
| **Sex** | Patient sex | Analizar diferencias |



***


### ¿Existen diferencias descriptivas en los marcadores inflamatorios entre pacientes con y sin bacteriemia?

Podemos contestar a esta pregunta comparando la tendencia y dispersión
de variables según el estado del hemocultivo.

### ¿Cómo es la distribución de las variables metabólicas y qué asimetría presentan?

Podemos describir la forma de distribución de cada feature y detectar
asimetría y valores extremos (outliers).

### ¿Cuál es la relación descriptiva entre variables fisiológicas y existen agrupaciones naturales?

Aquí podemos explorar asociaciones entre variables y detectar patrones
comunes.

### ¿Existen diferencias descriptivas en la proporción de bacteriemia según categorías clínicas simples?

Podemos describir frecuencias y proporciones.

------------------------------------------------------------------------

# 3. Análisis exploratorio de los datos (2,5 puntos)

## 3.1 Análisis descriptivo y gráfico (1 punto)

```{r}
# Guardamos una copia del dataset
bak_bacteremia <- bacteremia_df
# bacteremia_df <- bak_bacteremia
```


El primer dato que tenemos es la proporción que hay entre las dos
clases:

```{r}
class_ratio <- prop.table(table(bacteremia_df$BloodCulture))
sprintf("La proporción de la variable dependiente es: %.2f para los valores %s y %.2f y para los valores %s.", class_ratio[1]*100, names(class_ratio)[1], class_ratio[2]*100,
        names(class_ratio)[2])

```

Vemos que la diferencia del ratio de la posible variable dependiente
está bastante desbalanceada a favor de los casos de valores negativos
que positivos, 92-8.


A partir del conjunto de datos citado, mostrad los estadísticos descriptivos
más relevantes y comentaremos los resultados, teniendo en cuenta el tipo de variables.


```{r}
# Estadísticos descriptivos para variables numéricas excluyendo la ID y
# la variable target
num_summary <- bacteremia_df %>%
  select(-ID, -BloodCulture) %>%
  psych::describe()

num_summary
```


Vamos a crear histogramas y describir los valores para ver los datos en general de estos atributos para hacer una primera aproximación a los datos:


```{r}
# Histograma de edad con densidad
library(modeest)

modeest::mfv(bacteremia_df$AGE)

ggplot(bacteremia_df, aes(x = AGE)) +
  geom_histogram(aes(y = after_stat(density)), bins = 30,
                  fill = "skyblue", color = "black") +
geom_density(color = "red", size = 1.5) +
geom_vline(xintercept = mean(bacteremia_df$AGE),
          color = "blue", linetype = "dashed", size = 1) +
geom_vline(xintercept = median(bacteremia_df$AGE),
          color = "darkgreen", linetype = "dashed", size = 1) +
geom_vline(xintercept = modeest::mfv(bacteremia_df$AGE),
          color = "purple", linetype = "dashed", size = 1) +
labs(title = "Distribución de Edad",
subtitle = paste("Media =", round(mean(bacteremia_df$AGE), 1), "años",
                 "\nMediana =", round(median(bacteremia_df$AGE), 1), "años",
                  "\nModa =", round(modeest::mfv(bacteremia_df$AGE), 1), "años"),
x = "Edad (años)",
y = "Densidad"
) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```
Podemos detectar que la media está situada en 56.2 años con una mediana situada en 58. Pero los valores frecuentes está por los 66 años.


```{r}
# Box plot: Edad por estado del hemocultivo
ggplot(bacteremia_df, aes(x = factor(BloodCulture, labels = c("Negativo", "Positivo")),
y = AGE, fill = factor(BloodCulture))) +
geom_boxplot(alpha = 0.7) +
scale_fill_manual(values = c("#2ecc71", "#e74c3c")) +
labs(
title = "Distribución de Edad según el hemocultivo",
x = "Estado del hemocultivo ",
y = "Edad (años)"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "none"
)
```

```{r}
# Seleccionaremos los valores True y False
bacteremia_df$BloodCulture_bin <- ifelse(bacteremia_df$BloodCulture == "yes", 1, 0)

cor_data <- bacteremia_df %>%
select(-ID, -BloodCulture) %>%
drop_na()
# Creamos una matriz de correlación
cor_matrix <- cor(cor_data)

# Mostramos gráficamente
corrplot(
  cor_matrix,
  method = "color",
  type = "upper",
  tl.srt = 45,
  tl.cex = 0.7,
  number.cex = 0.6
)

```

Dado que no observamos muchas características debido a que se disponen de muchas features, procederemos con el seleccionar algunas y observar la matriz de correlación.

```{r}
# Correlación variables del tipo hemograma
vars_big <- c(
  "CRP", "HS", "LDH", "WBC",
  "ALB", "GLU", "TRIG",
  "CHOL", "FIB", "APTT", "BloodCulture_bin"
)

cor_big <- cor(
  bacteremia_df[, vars_big],
  use = "complete.obs"
)

corrplot(
  cor_big,
  method = "color",
  type = "upper",
  col = colorRampPalette(c("blue", "white", "red"))(200),
  addCoef.col = "black",
  number.cex = 0.8,     # correlation numbers
  tl.col = "black",
  tl.cex = 0.7,         # SMALLER labels
  tl.srt = 45,          # ROTATED labels (45 degrees)
  cl.cex = 1.0,
  title = "Matriz de correlación",
  mar = c(0, 0, 3, 0)
)

```

Continuaremos con el resto de variables 

```{r}
names(bacteremia_df)
```




## 3.2 Limpieza de los datos

```{r}

feature_categories <- list(
  
  # Complete Blood Count (CBC) - Hematology
  hematology = c("WBC", "RBC", "HGB", "HCT", "PLT", "MCV", "MCH", "MCHC", 
                 "RDW", "MPV", "PDW"),
  
  # White Blood Cell Differential
  wbc_differential = c("NEU", "NEUR", "LYM", "LYMR", "MONO", "MONOR", 
                       "EOS", "EOSR", "BASO", "BASOR", "NT"),
  
  # Coagulation
  coagulation = c("APTT", "FIB"),
  
  # Electrolytes & Minerals
  electrolytes = c("SODIUM", "POTASS", "CA", "PHOS", "MG"),
  
  # Kidney Function
  kidney = c("CREA", "BUN"),
  
  # Liver Function
  liver = c("GBIL", "TP", "ALB", "AP", "ASAT", "ALAT", "GGT", "CHE"),
  
  # Cardiac & Metabolic
  cardiac_metabolic = c("HS", "LDH", "CK", "GLU", "TRIG", "CHOL"),
  
  # Pancreatic Enzymes
  pancreatic = c("AMY", "PAMY", "LIP"),
  
  # Inflammatory Markers
  inflammatory = c("CRP")
)

# Create category labels for each feature
feature_info <- data.frame(
  variable = names(bacteremia),
  category = NA,
  stringsAsFactors = FALSE
)

for (cat_name in names(feature_categories)) {
  vars_in_cat <- feature_categories[[cat_name]]
  feature_info$category[feature_info$variable %in% vars_in_cat] <- cat_name
}

# Combine with missing data info
feature_analysis <- missing_summary %>%
  left_join(feature_info, by = "variable") %>%
  arrange(category, desc(missing_pct))

print(feature_analysis)
```





### El algoritmo MICE

La imputación múltiple mediante ecuaciones encadenadas es un método
robusto e informativo para gestionar la falta de datos en conjuntos de
datos. Este procedimiento rellena (imputa) los datos faltantes en un
conjunto de datos mediante una serie iterativa de modelos predictivos.
En cada iteración, cada variable especificada en el conjunto de datos se
imputa utilizando las demás variables. Estas iteraciones deben
ejecutarse hasta que se observe que se ha alcanzado la convergencia.

**Fuga de datos**:

MICE es especialmente útil si los valores faltantes están asociados con
la variable objetivo de una forma que introduce fugas. Por ejemplo,
supongamos que se desea modelar la retención de clientes en el momento
del registro. Una variable se recopila en el momento del registro o un
mes después. La ausencia de esa variable constituye una fuga de datos,
ya que indica que el cliente no se retuvo durante un mes.

**Análisis del embudo**:

La información suele recopilarse en diferentes etapas de un embudo. MICE
puede utilizarse para realizar estimaciones fundamentadas sobre las
características de las entidades en diferentes puntos de un embudo.

**Intervalos de confianza**:

MICE puede utilizarse para imputar valores faltantes; sin embargo, es
importante tener en cuenta que estos valores imputados constituyen una
predicción. Crear múltiples conjuntos de datos con diferentes valores
imputados permite realizar dos tipos de inferencia:

-   Distribución de valores imputados: Se puede crear un perfil para
    cada valor imputado, lo que permite realizar afirmaciones sobre la
    distribución probable de dicho valor.

-   Distribución de predicción del modelo: Con múltiples conjuntos de
    datos, se pueden crear múltiples modelos y una distribución de
    predicciones para cada muestra. Las muestras con valores imputados
    que no pudieron imputarse con mucha confianza presentarían una mayor
    varianza en sus predicciones.

Hacemos una copia del dataset y probamos solamente dos métodos.

```{r}
bak_bacteremia_df <- bacteremia_df
```

El primer método es performar con MICE, tal como explicado, sin embargo
este método podría tardar muchas horas en ejecutarse.

```{r}
# Multiple imputation using MICE
# cat("\nPerforming Multiple Imputation...\n")
# imputed_data <- mice(bacteremia_df, 
#                      m = 5, 
#                      maxit = 50, 
#                      method = 'pmm', 
#                      seed = 42)
# 
# # Extract first imputed dataset
# bacteremia_mice_imputed <- complete(imputed_data, 1)
# 
# # Check imputation quality
# cat("\nMissing values after imputation:", sum(is.na(bacteremia_mice_imputed)), "\n")
```

Understanding Scatterplots and Bivariate Analysis

```{r}

```

------------------------------------------------------------------------

## 3.2. Ejercicios de inferencia y simulación (1,5 puntos)

ver LAB3, LAB4, PEC2

------------------------------------------------------------------------

# 4. Modelos de aprendizaje automático (2,5 puntos)

ver LAB5 y PEC3

```{r}
bacteremia_cleaned <- na.omit(bacteremia_df)
bacteremia_cleaned
```


------------------------------------------------------------------------

# 5. Visualización (1,5 puntos)

Aplicación Shiny con alguna solución aportada / análisis

ver LAB6 y PEC3

------------------------------------------------------------------------

# 6. Conclusiones (0,5 puntos)

Valoraciones finales...

-   ¿Disponemos de conclusiones finales?
-   ¿Sería necesario realizar un análisis más avanzado?
-   ¿Faltan datos para obtener otro tipo de información como…?
-   ¿Se puede utilizar alguna de las conclusiones para tomar algún tipo
    de decisiones?

De acorde al paper analizado ["Diagnostic performance of the time to
positivity of blood cultures to distinguish true bacteremia from
contaminants based on an automated system"][^98] serían de interés integrar otras variables del paciente para poder detectar patrones más allá de los datos disponibles del tipo fisiológico.

Por ejemplo, un uso de los tiempo de biocultivos, realizados en esta otra investigación, se hicieron simulaciones para optimizar las pruebas de laboratorio. [^99]



------------------------------------------------------------------------

# References

[^1]: Heinze, G. (2023). Bacteremia [Data set]. In PLoS One (Version S2, Vol. 9, Number 9, p. e106765). Zenodo. https://doi.org/10.5281/zenodo.7554815

[^2] “Bacteriemia - Wikipedia, la enciclopedia libre.” Accessed: Jan. 09, 2026. [Online]. Available: https://es.wikipedia.org/wiki/Bacteriemia
  
  
  
[^98]: Laque-Ale, A., Hueda-Zavaleta, M., Gómez de la Torre, J. C.,
    Alvarado, L., & Cáceres Del Águila, J. A. (2023). Diagnostic
    performance of the time to positivity of blood cultures to
    distinguish true bacteremia from contaminants based on an automated
    system. Utilidad diagnóstica de los tiempos de positividad de
    hemocultivos para distinguir verdaderas bacteriemias de
    contaminantes en base a un sistema automatizado. Revista peruana de
    medicina experimental y salud publica, 40(4), 451–458.
    <https://doi.org/10.17843/rpmesp.2023.404.12724>

[^99]:  Roberts, G., & Gerada, A. (2024). Simulation to optimize the laboratory diagnosis of bacteremia: event times dataset from observational and retrospective studies (v1.0) [Data set]. Zenodo. https://doi.org/10.5281/zenodo.10991330


Blake, C.L. & Merz, C.J. (1998). UCI Repository of Machine Learning
Databases. Irvine, CA: University of California, Irvine, Department of
Information and Computer Science. Formerly available from
<http://www.ics.uci.edu/~mlearn/MLRepository.html>.

-   <https://shiny.posit.co/py/templates/>

------------------------------------------------------------------------
